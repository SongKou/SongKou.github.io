<!doctype html>
<html lang="en-us">
  <head>
    <title>Python_mysql // Council of Elrond</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.118.2">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Song Kou" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="/css/main.min.3c3c186cd62e563ad6e2f00a89dbee656ab912d1d46f856b5605dd0232521e2a.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Python_mysql"/>
<meta name="twitter:description" content="Python Query mysql To use Python to query mysql DB. There are two popular modules are used:
pymysql sqlalchemy ( need to install mysqlconnector in my scenario) pip install mysql-connector-python pymysql: ekoudb = pymysql.connect(host=&#39;10.10.80.127&#39;, port=3306, user=&#39;ekou&#39;, password=&#39;abcd12334&#39;, database=&#39;ekoutest&#39;) #get cursor cursor = ekoudb.cursor() def insert_a_item(SqlLang): &#34;&#34;&#34; Insert items &#34;&#34;&#34; try: cursor.execute(SqlLang) ekoudb.commit() except Exception as e: print(&#39;Insert data fail&#39;) print(e) ekoudb.rollback() # release resource cursor.close() ekoudb.close() #insert_a_item(SQL_INSERT_A_ITEM) SQL_INSERT_MANY_ITEMS = &#34;INSERT INTO bird_table (origin, hostname,descr,ver,protocol,neighboraddr,neighboras,status,sinceday,sincetime) VALUES(%s, %s, %s, %s, %s, %s, %s, %s, %s, %s)&#34; MULTIENTRY = [[&#34;update&#34;,&#34;host1&#34;,&#34;descr1&#34;,&#34;ipv6&#34;,&#34;BGP&#34;,&#34;2123123&#34;,&#34;231233&#34;,&#34;Idle&#34;,&#34;2021-02-02&#34;,&#34;16:50:07&#34;],\ [&#34;update&#34;,&#34;host2&#34;,&#34;descr2&#34;,&#34;ipv6&#34;,&#34;BGP&#34;,&#34;ipv6_addr1&#34;,&#34;65300&#34;,&#34;Idle&#34;,&#34;2021-02-02&#34;,&#34;16:50:07&#34;],\ [&#34;update&#34;,&#34;host3&#34;,&#34;descr3&#34;,&#34;ipv4&#34;,&#34;BGP&#34;,&#34;10."/>

    <meta property="og:title" content="Python_mysql" />
<meta property="og:description" content="Python Query mysql To use Python to query mysql DB. There are two popular modules are used:
pymysql sqlalchemy ( need to install mysqlconnector in my scenario) pip install mysql-connector-python pymysql: ekoudb = pymysql.connect(host=&#39;10.10.80.127&#39;, port=3306, user=&#39;ekou&#39;, password=&#39;abcd12334&#39;, database=&#39;ekoutest&#39;) #get cursor cursor = ekoudb.cursor() def insert_a_item(SqlLang): &#34;&#34;&#34; Insert items &#34;&#34;&#34; try: cursor.execute(SqlLang) ekoudb.commit() except Exception as e: print(&#39;Insert data fail&#39;) print(e) ekoudb.rollback() # release resource cursor.close() ekoudb.close() #insert_a_item(SQL_INSERT_A_ITEM) SQL_INSERT_MANY_ITEMS = &#34;INSERT INTO bird_table (origin, hostname,descr,ver,protocol,neighboraddr,neighboras,status,sinceday,sincetime) VALUES(%s, %s, %s, %s, %s, %s, %s, %s, %s, %s)&#34; MULTIENTRY = [[&#34;update&#34;,&#34;host1&#34;,&#34;descr1&#34;,&#34;ipv6&#34;,&#34;BGP&#34;,&#34;2123123&#34;,&#34;231233&#34;,&#34;Idle&#34;,&#34;2021-02-02&#34;,&#34;16:50:07&#34;],\ [&#34;update&#34;,&#34;host2&#34;,&#34;descr2&#34;,&#34;ipv6&#34;,&#34;BGP&#34;,&#34;ipv6_addr1&#34;,&#34;65300&#34;,&#34;Idle&#34;,&#34;2021-02-02&#34;,&#34;16:50:07&#34;],\ [&#34;update&#34;,&#34;host3&#34;,&#34;descr3&#34;,&#34;ipv4&#34;,&#34;BGP&#34;,&#34;10." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://songkou.github.io/posts/python_mysql/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-02-07T13:21:07+08:00" />
<meta property="article:modified_time" content="2021-02-07T13:21:07+08:00" />


  </head>
  <body>
    <header class="app-header">
      <a href="https://songkou.github.io/"><img class="app-header-avatar" src="/avatar.jpg" alt="Song Kou" /></a>
      <span class="app-header-title">Council of Elrond</span>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/">Home</a>
             - 
          
          <a class="app-header-menu-item" href="/categories/">Categories</a>
             - 
          
          <a class="app-header-menu-item" href="/tags/">Tags</a>
      </nav>
      <p>ignorance more frequently begets confidence than does knowledge</p>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Python_mysql</h1>
      <div class="post-meta">
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Feb 7, 2021
        </div>
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          3 min read
        </div>
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line>
</svg>
              <a class="tag" href="https://songkou.github.io/tags/python/">Python</a>
              <a class="tag" href="https://songkou.github.io/tags/mysql/">mysql</a>
        </div>
      </div>
    </header>
    <div class="post-content">
      <h1 id="python-query-mysql">Python Query mysql</h1>
<p>To use Python to query mysql DB. There are two popular modules are used:</p>
<ol>
<li>pymysql</li>
<li>sqlalchemy ( need to install mysqlconnector in my scenario) <code>pip install mysql-connector-python</code></li>
</ol>
<h3 id="pymysql">pymysql:</h3>
<pre tabindex="0"><code>ekoudb = pymysql.connect(host=&#39;10.10.80.127&#39;,  
  port=3306,  
  user=&#39;ekou&#39;,  
  password=&#39;abcd12334&#39;,  
  database=&#39;ekoutest&#39;)  
  
 #get cursor  
cursor = ekoudb.cursor()

def insert_a_item(SqlLang):  
    &#34;&#34;&#34;  
 Insert items &#34;&#34;&#34;  
    try:  
        cursor.execute(SqlLang)  
        ekoudb.commit()  
    except Exception as e:  
        print(&#39;Insert data fail&#39;)  
        print(e)  
        ekoudb.rollback()  
    # release resource  
  cursor.close()  
    ekoudb.close()  
#insert_a_item(SQL_INSERT_A_ITEM)
SQL_INSERT_MANY_ITEMS = &#34;INSERT INTO bird_table (origin, hostname,descr,ver,protocol,neighboraddr,neighboras,status,sinceday,sincetime) VALUES(%s, %s, %s, %s, %s, %s, %s, %s, %s, %s)&#34;

MULTIENTRY = [[&#34;update&#34;,&#34;host1&#34;,&#34;descr1&#34;,&#34;ipv6&#34;,&#34;BGP&#34;,&#34;2123123&#34;,&#34;231233&#34;,&#34;Idle&#34;,&#34;2021-02-02&#34;,&#34;16:50:07&#34;],\  
[&#34;update&#34;,&#34;host2&#34;,&#34;descr2&#34;,&#34;ipv6&#34;,&#34;BGP&#34;,&#34;ipv6_addr1&#34;,&#34;65300&#34;,&#34;Idle&#34;,&#34;2021-02-02&#34;,&#34;16:50:07&#34;],\  
[&#34;update&#34;,&#34;host3&#34;,&#34;descr3&#34;,&#34;ipv4&#34;,&#34;BGP&#34;,&#34;10.10.1.1&#34;,&#34;65002&#34;,&#34;Established&#34;,&#34;2021-02-02&#34;,&#34;15:50:13&#34;],\  
[&#34;update&#34;,&#34;host4&#34;,&#34;descr4&#34;,&#34;ipv4&#34;,&#34;BGP&#34;,&#34;10.10.1.3&#34;,&#34;65003&#34;,&#34;Established&#34;,&#34;2021-02-02&#34;,&#34;15:50:13&#34;]]

def insert_items(MANYTIMESFORMAT,SqlLang):  
    try:  
        cursor.executemany(MANYTIMESFORMAT, SqlLang)  
        ekoudb.commit()  
    except Exception as e:  
        print(&#34;Insert_error&#34;)  
        ekoudb.rollback()  
    # release resource  
  cursor.close()  
    ekoudb.close()

def query(SqlLang):  
    &#34;&#34;&#34;query&#34;&#34;&#34;  
  # query all data 
  cursor.execute(SqlLang)  
    print(&#39;+--------+-----------+---------------------------+------+----------+-\  
-------------------------+------------+-------------+------------+-----------+&#39;)  
    print(&#39;| origin | hostname  |          descr            | ver  | protocol | \  
 neighboraddr       | neighboras |    status   |  sinceday  | sincetime |&#39;)  
    print(&#39;+--------+-----------+---------------------------+------+----------+-\  
-------------------------+------------+-------------+------------+-----------+&#39;)  
    # matrix data  
  rows = cursor.fetchall()  
    for row in rows:  
        origin = row[0]  
        hostname = row[1]  
        descr = row[2]  
        ver = row[3]  
        protocol = row[4]  
        neighboraddr = str(row[5])  
        neighboras = str(row[6])  
        status = row[7]  
        sinceday = str(row[7])  
        sincetime = str(row[9])  
  
#        print(&#39;| &#39; + origin.rjust(2) + &#39;|&#39;.rjust(7) + hostname.rjust(2) + &#39;|&#39;.rjust(10) + descr.rjust(2) + &#39;|&#39;.rjust(26) + ver.rjust(2)  + &#39;|&#39;.rjust(5) + protocol.rjust(2) + &#39;|&#39;.rjust(9) + neighboraddr.rjust(2) +  + &#39;|&#39;.rjust(25) + neighboras.rjust(2) + &#39;|&#39;.rjust(11) + status.rjust(2) + &#39;|&#39;.rjust(12) + sinceday.rjust(2) + &#39;|&#39;.rjust(11) + sincetime.rjust(2))  
#        print(&#39;| &#39; + origin.rjust(2) + &#39;\t|&#39; + &#39;\t&#39; + hostname  + &#39;\t|&#39;  + &#39;\t&#39;+ descr + &#39;\t|&#39; + &#39;\t&#39; + ver  + &#39;\t|&#39; + &#39;\t&#39; + protocol + &#39;\t|&#39;+&#39;\t&#39;+neighboras + &#39;\t|&#39;+&#39;\t&#39;+neighboraddr + &#39;\t|&#39;+&#39;\t&#39;+status + &#39;\t|&#39;+ &#39;\t&#39; + sinceday + &#39;\t|&#39;+ &#39;\t&#39; +sincetime + &#39;\t|&#39;)  
  print(&#39;|&#39; + format(origin,&#34;&lt;8&#34;) + format(&#34;|&#34;,&#34;&lt;2&#34;) + format(hostname,&#34;&lt;10&#34;) + format(&#34;|&#34;,&#34;&lt;2&#34;) + format(descr,&#34;&lt;26&#34;) + format(&#34;|&#34;,&#34;&lt;2&#34;) + format(ver,&#34;&lt;5&#34;) + format(&#34;|&#34;,&#34;&lt;2&#34;) + format(protocol,&#34;&lt;9&#34;) + format(&#34;|&#34;,&#34;&lt;2&#34;) + format(neighboraddr,&#34;&lt;25&#34;) + format(&#34;|&#34;,&#34;&lt;2&#34;) + format(neighboras,&#34;&lt;11&#34;) + format(&#34;|&#34;,&#34;&lt;2&#34;) + format(status,&#34;&lt;12&#34;) + format(&#34;|&#34;,&#34;&lt;2&#34;) + format(sinceday,&#34;&lt;11&#34;) + format(&#34;|&#34;,&#34;&lt;2&#34;) + format(sincetime,&#34;&lt;10&#34;) + &#34;|&#34; )  
    print(&#39;+--------+-----------+---------------------------+------+----------+-\  
-------------------------+------------+-------------+------------+-----------+&#39;)  
    # release resource  
  cursor.close()  
    ekoudb.close()
    


SQL_UPDATE = &#34;UPDATE bird_table SET hostname=&#39;%s&#39;,status=&#39;%s&#39; WHERE descr=&#39;%s&#39;&#34;  
  
def update(SqlLang):  
    &#34;&#34;&#34;  
  update 
 :return: &#34;&#34;&#34;  sql_update = SqlLang % (&#39;hostname3&#39;, &#39;connect&#39;, &#39;descr_1&#39;)  
    try:  
        cursor.execute(sql_update)  
        ekoudb.commit()  
    except Exception as e:  
        ekoudb.rollback()  
        print(&#39;error when update data&#39;)  
        print(e)  
    # release resource  
  cursor.close()  
    ekoudb.close()  
  
update(SQL_UPDATE)
SQL_DELETE = &#34;DELETE FROM bird_table WHERE descr=&#39;%s&#39;&#34;  
  
def delete(SqlLang,delete_string):  
    &#34;&#34;&#34;  
  delete record  
 :return: &#34;&#34;&#34;  try:  
        # delete sql  
  sql_del = SqlLang % (delete_string)  
        cursor.execute(sql_del)  
        ekoudb.commit()  
    except Exception as e:  
        # rollback when error  
  ekoudb.rollback()  
        print(e)  
    # release resource  
  cursor.close()  
    ekoudb.close()  
  
delete(SQL_DELETE,&#39;23123213213&#39;)
</code></pre><h3 id="sqlalchemy">sqlalchemy:</h3>
<pre tabindex="0"><code>engine = create_engine(&#34;mysql+mysqlconnector://ekou:PASSWORD@10.10.80.127:3306/ekoutest?charset=utf8mb4&#34;)

metadata = MetaData(engine)  
  
Session = sessionmaker()  # create a customized session  
Session.configure(bind=engine)  # link to this session  
session = Session()
users_table = Table(&#39;bird_table&#39;, metadata, autoload=True)

result=users_table.select(and_(users_table.c.descr == &#34;descr&#34;, users_table.c.neighboraddr == &#34;NEIGHBOR_ADDR&#34;)).execute()  
for item in result.fetchall():  
    print (item)

&#39;&#39;&#39;  
create table  
&#39;&#39;&#39;  
users_table = Table(&#39;users&#39;,  
  metadata,  
  Column(&#39;id&#39;, Integer, primary_key=True),  
  Column(&#39;name&#39;, String(40)),  
  Column(&#39;email&#39;, String(120)))  
if not users_table.exists():  
    users_table.create()  
  
&#39;&#39;&#39;  
load table  
&#39;&#39;&#39;  
users_table = Table(&#39;users&#39;, metadata, autoload=True)  
  
&#39;&#39;&#39;  
insert  
&#39;&#39;&#39;  
users_table.insert().execute(name=&#34;sss&#34;, email=&#34;eee@eee.com&#34;)  
users_table.insert().execute(name=&#34;ttt&#34;, email=&#34;tt@eee.com&#34;)  
&#39;&#39;&#39;  
update  
&#39;&#39;&#39;  
users_table.update(users_table.c.name == &#34;ttt&#34;).execute(name=&#34;ddd&#34;)
</code></pre><h3 id="conclusion">conclusion:</h3>
<p>for easier get on hand, pymsql would be good enough to use. but for advanced, need to use sqlalchemy.</p>
<h3 id="reference-link">reference link:</h3>
<p><a href="https://docs.sqlalchemy.org/en/14/dialects/mysql.html#module-sqlalchemy.dialects.mysql.mysqlconnector">https://docs.sqlalchemy.org/en/14/dialects/mysql.html#module-sqlalchemy.dialects.mysql.mysqlconnector</a></p>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
