<!doctype html>
<html lang="en-us">
  <head>
    <title>Python_Mysql // Council of Elrond</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.80.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Ethan Song Kou" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://songkou.github.io/css/main.min.68e582a4d4ed824d6b7e3b5b37cae47eb3779bd631046379d0e68b38230cc3e2.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Python_Mysql"/>
<meta name="twitter:description" content="Python Query mysql To use Python to query mysql DB. There are two popular modules are used:
 pymysql sqlalchemy ( need to install mysqlconnector in my scenario) pip install mysql-connector-python  pymysql: ekoudb = pymysql.connect(host=&#39;10.10.80.127&#39;, port=3306, user=&#39;ekou&#39;, password=&#39;abcd12334&#39;, database=&#39;ekoutest&#39;) #get cursor cursor = ekoudb.cursor() def insert_a_item(SqlLang): &quot;&quot;&quot; Insert items &quot;&quot;&quot; try: cursor.execute(SqlLang) ekoudb.commit() except Exception as e: print(&#39;Insert data fail&#39;) print(e) ekoudb.rollback() # release resource cursor.close() ekoudb.close() #insert_a_item(SQL_INSERT_A_ITEM) SQL_INSERT_MANY_ITEMS = &quot;INSERT INTO bird_table (origin, hostname,descr,ver,protocol,neighboraddr,neighboras,status,sinceday,sincetime) VALUES(%s, %s, %s, %s, %s, %s, %s, %s, %s, %s)&quot; MULTIENTRY = [[&quot;update&quot;,&quot;host1&quot;,&quot;descr1&quot;,&quot;ipv6&quot;,&quot;BGP&quot;,&quot;2123123&quot;,&quot;231233&quot;,&quot;Idle&quot;,&quot;2021-02-02&quot;,&quot;16:50:07&quot;],\ [&quot;update&quot;,&quot;host2&quot;,&quot;descr2&quot;,&quot;ipv6&quot;,&quot;BGP&quot;,&quot;ipv6_addr1&quot;,&quot;65300&quot;,&quot;Idle&quot;,&quot;2021-02-02&quot;,&quot;16:50:07&quot;],\ [&quot;update&quot;,&quot;host3&quot;,&quot;descr3&quot;,&quot;ipv4&quot;,&quot;BGP&quot;,&quot;10."/>

    <meta property="og:title" content="Python_Mysql" />
<meta property="og:description" content="Python Query mysql To use Python to query mysql DB. There are two popular modules are used:
 pymysql sqlalchemy ( need to install mysqlconnector in my scenario) pip install mysql-connector-python  pymysql: ekoudb = pymysql.connect(host=&#39;10.10.80.127&#39;, port=3306, user=&#39;ekou&#39;, password=&#39;abcd12334&#39;, database=&#39;ekoutest&#39;) #get cursor cursor = ekoudb.cursor() def insert_a_item(SqlLang): &quot;&quot;&quot; Insert items &quot;&quot;&quot; try: cursor.execute(SqlLang) ekoudb.commit() except Exception as e: print(&#39;Insert data fail&#39;) print(e) ekoudb.rollback() # release resource cursor.close() ekoudb.close() #insert_a_item(SQL_INSERT_A_ITEM) SQL_INSERT_MANY_ITEMS = &quot;INSERT INTO bird_table (origin, hostname,descr,ver,protocol,neighboraddr,neighboras,status,sinceday,sincetime) VALUES(%s, %s, %s, %s, %s, %s, %s, %s, %s, %s)&quot; MULTIENTRY = [[&quot;update&quot;,&quot;host1&quot;,&quot;descr1&quot;,&quot;ipv6&quot;,&quot;BGP&quot;,&quot;2123123&quot;,&quot;231233&quot;,&quot;Idle&quot;,&quot;2021-02-02&quot;,&quot;16:50:07&quot;],\ [&quot;update&quot;,&quot;host2&quot;,&quot;descr2&quot;,&quot;ipv6&quot;,&quot;BGP&quot;,&quot;ipv6_addr1&quot;,&quot;65300&quot;,&quot;Idle&quot;,&quot;2021-02-02&quot;,&quot;16:50:07&quot;],\ [&quot;update&quot;,&quot;host3&quot;,&quot;descr3&quot;,&quot;ipv4&quot;,&quot;BGP&quot;,&quot;10." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://songkou.github.io/post/python_mysql/" />
<meta property="article:published_time" content="2021-02-07T14:27:59-05:00" />
<meta property="article:modified_time" content="2021-02-07T14:27:59-05:00" />


  </head>
  <body>
    <header class="app-header">
      <a href="https://songkou.github.io/"><img class="app-header-avatar" src="/avatar.jpg" alt="Ethan Song Kou" /></a>
      <h1>Council of Elrond</h1>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/">Home</a>
             - 
          
          <a class="app-header-menu-item" href="/tags/">Tags</a>
      </nav>
      <p>ignorance more frequently begets confidence than does knowledge</p>
      <div class="app-header-social">
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Python_Mysql</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Feb 7, 2021
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          3 min read
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line>
</svg>
              <a class="tag" href="https://songkou.github.io/tags/python/">Python</a>
              <a class="tag" href="https://songkou.github.io/tags/mysql/">Mysql</a>
        </div>
      </div>
    </header>
    <div class="post-content">
      <h1 id="python-query-mysql">Python Query mysql</h1>
<p>To use Python to query mysql DB. There are two popular modules are used:</p>
<ol>
<li>pymysql</li>
<li>sqlalchemy ( need to install mysqlconnector in my scenario)  <code>pip install mysql-connector-python</code></li>
</ol>
<h3 id="pymysql">pymysql:</h3>
<pre><code>ekoudb = pymysql.connect(host='10.10.80.127',  
  port=3306,  
  user='ekou',  
  password='abcd12334',  
  database='ekoutest')  
  
 #get cursor  
cursor = ekoudb.cursor()

def insert_a_item(SqlLang):  
    &quot;&quot;&quot;  
 Insert items &quot;&quot;&quot;  
    try:  
        cursor.execute(SqlLang)  
        ekoudb.commit()  
    except Exception as e:  
        print('Insert data fail')  
        print(e)  
        ekoudb.rollback()  
    # release resource  
  cursor.close()  
    ekoudb.close()  
#insert_a_item(SQL_INSERT_A_ITEM)
SQL_INSERT_MANY_ITEMS = &quot;INSERT INTO bird_table (origin, hostname,descr,ver,protocol,neighboraddr,neighboras,status,sinceday,sincetime) VALUES(%s, %s, %s, %s, %s, %s, %s, %s, %s, %s)&quot;

MULTIENTRY = [[&quot;update&quot;,&quot;host1&quot;,&quot;descr1&quot;,&quot;ipv6&quot;,&quot;BGP&quot;,&quot;2123123&quot;,&quot;231233&quot;,&quot;Idle&quot;,&quot;2021-02-02&quot;,&quot;16:50:07&quot;],\  
[&quot;update&quot;,&quot;host2&quot;,&quot;descr2&quot;,&quot;ipv6&quot;,&quot;BGP&quot;,&quot;ipv6_addr1&quot;,&quot;65300&quot;,&quot;Idle&quot;,&quot;2021-02-02&quot;,&quot;16:50:07&quot;],\  
[&quot;update&quot;,&quot;host3&quot;,&quot;descr3&quot;,&quot;ipv4&quot;,&quot;BGP&quot;,&quot;10.10.1.1&quot;,&quot;65002&quot;,&quot;Established&quot;,&quot;2021-02-02&quot;,&quot;15:50:13&quot;],\  
[&quot;update&quot;,&quot;host4&quot;,&quot;descr4&quot;,&quot;ipv4&quot;,&quot;BGP&quot;,&quot;10.10.1.3&quot;,&quot;65003&quot;,&quot;Established&quot;,&quot;2021-02-02&quot;,&quot;15:50:13&quot;]]

def insert_items(MANYTIMESFORMAT,SqlLang):  
    try:  
        cursor.executemany(MANYTIMESFORMAT, SqlLang)  
        ekoudb.commit()  
    except Exception as e:  
        print(&quot;Insert_error&quot;)  
        ekoudb.rollback()  
    # release resource  
  cursor.close()  
    ekoudb.close()

def query(SqlLang):  
    &quot;&quot;&quot;query&quot;&quot;&quot;  
  # query all data 
  cursor.execute(SqlLang)  
    print('+--------+-----------+---------------------------+------+----------+-\  
-------------------------+------------+-------------+------------+-----------+')  
    print('| origin | hostname  |          descr            | ver  | protocol | \  
 neighboraddr       | neighboras |    status   |  sinceday  | sincetime |')  
    print('+--------+-----------+---------------------------+------+----------+-\  
-------------------------+------------+-------------+------------+-----------+')  
    # matrix data  
  rows = cursor.fetchall()  
    for row in rows:  
        origin = row[0]  
        hostname = row[1]  
        descr = row[2]  
        ver = row[3]  
        protocol = row[4]  
        neighboraddr = str(row[5])  
        neighboras = str(row[6])  
        status = row[7]  
        sinceday = str(row[7])  
        sincetime = str(row[9])  
  
#        print('| ' + origin.rjust(2) + '|'.rjust(7) + hostname.rjust(2) + '|'.rjust(10) + descr.rjust(2) + '|'.rjust(26) + ver.rjust(2)  + '|'.rjust(5) + protocol.rjust(2) + '|'.rjust(9) + neighboraddr.rjust(2) +  + '|'.rjust(25) + neighboras.rjust(2) + '|'.rjust(11) + status.rjust(2) + '|'.rjust(12) + sinceday.rjust(2) + '|'.rjust(11) + sincetime.rjust(2))  
#        print('| ' + origin.rjust(2) + '\t|' + '\t' + hostname  + '\t|'  + '\t'+ descr + '\t|' + '\t' + ver  + '\t|' + '\t' + protocol + '\t|'+'\t'+neighboras + '\t|'+'\t'+neighboraddr + '\t|'+'\t'+status + '\t|'+ '\t' + sinceday + '\t|'+ '\t' +sincetime + '\t|')  
  print('|' + format(origin,&quot;&lt;8&quot;) + format(&quot;|&quot;,&quot;&lt;2&quot;) + format(hostname,&quot;&lt;10&quot;) + format(&quot;|&quot;,&quot;&lt;2&quot;) + format(descr,&quot;&lt;26&quot;) + format(&quot;|&quot;,&quot;&lt;2&quot;) + format(ver,&quot;&lt;5&quot;) + format(&quot;|&quot;,&quot;&lt;2&quot;) + format(protocol,&quot;&lt;9&quot;) + format(&quot;|&quot;,&quot;&lt;2&quot;) + format(neighboraddr,&quot;&lt;25&quot;) + format(&quot;|&quot;,&quot;&lt;2&quot;) + format(neighboras,&quot;&lt;11&quot;) + format(&quot;|&quot;,&quot;&lt;2&quot;) + format(status,&quot;&lt;12&quot;) + format(&quot;|&quot;,&quot;&lt;2&quot;) + format(sinceday,&quot;&lt;11&quot;) + format(&quot;|&quot;,&quot;&lt;2&quot;) + format(sincetime,&quot;&lt;10&quot;) + &quot;|&quot; )  
    print('+--------+-----------+---------------------------+------+----------+-\  
-------------------------+------------+-------------+------------+-----------+')  
    # release resource  
  cursor.close()  
    ekoudb.close()
    


SQL_UPDATE = &quot;UPDATE bird_table SET hostname='%s',status='%s' WHERE descr='%s'&quot;  
  
def update(SqlLang):  
    &quot;&quot;&quot;  
  update 
 :return: &quot;&quot;&quot;  sql_update = SqlLang % ('hostname3', 'connect', 'descr_1')  
    try:  
        cursor.execute(sql_update)  
        ekoudb.commit()  
    except Exception as e:  
        ekoudb.rollback()  
        print('error when update data')  
        print(e)  
    # release resource  
  cursor.close()  
    ekoudb.close()  
  
update(SQL_UPDATE)
SQL_DELETE = &quot;DELETE FROM bird_table WHERE descr='%s'&quot;  
  
def delete(SqlLang,delete_string):  
    &quot;&quot;&quot;  
  delete record  
 :return: &quot;&quot;&quot;  try:  
        # delete sql  
  sql_del = SqlLang % (delete_string)  
        cursor.execute(sql_del)  
        ekoudb.commit()  
    except Exception as e:  
        # rollback when error  
  ekoudb.rollback()  
        print(e)  
    # release resource  
  cursor.close()  
    ekoudb.close()  
  
delete(SQL_DELETE,'23123213213')
</code></pre>
<h3 id="sqlalchemy">sqlalchemy:</h3>
<pre><code>engine = create_engine(&quot;mysql+mysqlconnector://ekou:PASSWORD@10.10.80.127:3306/ekoutest?charset=utf8mb4&quot;)

metadata = MetaData(engine)  
  
Session = sessionmaker()  # create a customized session  
Session.configure(bind=engine)  # link to this session  
session = Session()
users_table = Table('bird_table', metadata, autoload=True)

result=users_table.select(and_(users_table.c.descr == &quot;descr&quot;, users_table.c.neighboraddr == &quot;NEIGHBOR_ADDR&quot;)).execute()  
for item in result.fetchall():  
    print (item)

'''  
create table  
'''  
users_table = Table('users',  
  metadata,  
  Column('id', Integer, primary_key=True),  
  Column('name', String(40)),  
  Column('email', String(120)))  
if not users_table.exists():  
    users_table.create()  
  
'''  
load table  
'''  
users_table = Table('users', metadata, autoload=True)  
  
'''  
insert  
'''  
users_table.insert().execute(name=&quot;sss&quot;, email=&quot;eee@eee.com&quot;)  
users_table.insert().execute(name=&quot;ttt&quot;, email=&quot;tt@eee.com&quot;)  
'''  
update  
'''  
users_table.update(users_table.c.name == &quot;ttt&quot;).execute(name=&quot;ddd&quot;)
</code></pre>
<h3 id="conclusion">conclusion:</h3>
<p>for easier get on hand, pymsql would be good enough to use. but for advanced, need to use sqlalchemy.</p>
<h3 id="reference-link">reference link:</h3>
<p><a href="https://docs.sqlalchemy.org/en/14/dialects/mysql.html#module-sqlalchemy.dialects.mysql.mysqlconnector">https://docs.sqlalchemy.org/en/14/dialects/mysql.html#module-sqlalchemy.dialects.mysql.mysqlconnector</a></p>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
